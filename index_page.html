<!DOCTYPE html>
<html>
<head>
    <title>Uber Trip Data</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- <link href="slider.css" rel="stylesheet" type="text/css" />  -->
    <!-- 可选的 Bootstrap 主题文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-1.9.1.min.js" integrity="sha256-wS9gmOZBqsqWxgIVgA8Y9WcQOa7PgSIX+rPA0VL2rbQ=" crossorigin="anonymous"></script>

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-database.js"></script>
    <script src="https://kit.fontawesome.com/afa3fff295.js" crossorigin="anonymous"></script>
   
    <style>
        /* 移除 body 的固定 padding，改由 container 控制 */
        body { 
            padding: 0; 
            margin: 0; 
            background-color: #f5f5f5; 
        }
        /* 這是內容容器，在手機上間距變小，大螢幕變大 */
        .main-container {padding: 15px;}
        @media (min-width: 768px) {.main-container { padding: 30px 50px; }}

        /* 讓 Banner 容器黑底，確保圖片沒填滿時不露白 */
        .banner-wrapper {
            background-color: black;
            width: 100%;
            overflow: hidden;
            text-align: center;
        }

        /* 讓 Banner 圖片能隨螢幕寬度縮放 */
        .banner-img {
            width: 100%;
            max-width: 1200px;  /* 限制最大寬度，避免在大螢幕過度拉伸 */
            height: 250px;
            object-fit: contain;     /* 關鍵：等比例縮放填滿，不壓扁 */
            margin: 0 auto;
            display: block;
        }

        /* 強制功能列容器字體正常，避免繼承 36px */
        .filter-row {
            margin-top: 30px;
            padding: 0 15px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;    /* 垂直居中 */
            justify-content: center; /* 水平居中 */
            font-size: 14px;         /* 重設正常字體大小 */
        }
    
        /* 讓 col 區塊在 Flex 模式下不要亂跑 */
        .filter-item {
            margin-bottom: 15px;
            padding: 0 10px;
            display: flex;
            align-items: center;
        }

        /* 手機版響應式：螢幕窄時，高度可以縮小一點，才不會佔滿整個手機畫面 */
        @media (max-width: 768px) {
            .banner-img {
                height: 150px;
            }
        }

        /* 讓表格在手機上可以橫向滑動，不會撐破版面 */
        .table-responsive {
            border: none;
            margin-top: 20px;
        }
        i{cursor: pointer;}

        /* --- 導覽列縮減樣式 --- */

        /* 1. 調整導覽列整體最小高度 (原本預設是 50px) */
        .navbar {
            min-height: 40px !important;
        }

        /* 2. 縮小左側 "My Uber" 的字體與邊距 */
        .navbar-brand {
            font-size: 14px !important;    /* 縮小字體 */
            padding: 10px 15px !important; /* 縮減上下內邊距 (10px) */
            height: 40px !important;       /* 配合 navbar 高度 */
        }

        /* 3. 縮小 "DATASET" 選單的字體與邊距 */
        .navbar-nav > li > a {
            font-size: 13px !important;    /* 縮小字體 */
            padding-top: 10px !important;    /* 縮減上方間距 */
            padding-bottom: 10px !important; /* 縮減下方間距 */
        }

        /* 4. 修正右側搜尋框的位置，讓它在變窄的導覽列中垂直置中 */
        .navbar-form {
            margin-top: 3px !important;
            margin-bottom: 3px !important;
        }
        
        .navbar-form .form-control {
            height: 30px; /* 搜尋框也稍微變矮一點點才協調 */
        }
        
        .navbar-form .btn {
            padding: 4px 10px; /* 搜尋按鈕也稍微縮小 */
        }

        /* 1. 強制讓表格標題內的文字和箭頭圖示永遠排在同一行 */
        th {
            white-space: nowrap !important; /* 確保不換行 */
            vertical-align: middle !important;
            padding: 15px 10px !important;   /* 增加一點寬度空間 */
            background-color: #eee;         /* 給標題一個淺灰色底，更有表格層次感 */
        }
        
        /* 2. 讓箭頭緊隨文字，避免被擠壓 */
        th i {
            font-size: 18px !important;    /* 放大箭頭，原本可能只有 10-12px */
            margin-left: 6px !important;   /* 增加文字與箭頭間的距離 */
            color: #333;                   /* 讓顏色深一點，看起來更清晰 */
            display: inline-block !important;
            vertical-align: middle !important;
            transition: transform 0.2s;    /* 增加一點點平滑動畫效果 */
        }
        /* 當滑鼠移上去時變色，增加互動感 */
        th i:hover {
            color: #337ab7;                /* 變成 Bootstrap 的藍色 */
            transform: scale(1.2);         /* 滑鼠移上去再放大 20%，增加點擊反饋 */
        }
                
        /* 3. 修正表格容器，確保小螢幕可滑動但不擠壓內容 */
        .table-responsive {
            width: 100%;
            overflow-x: auto !important;
            -webkit-overflow-scrolling: touch;
            margin-top: 20px;
        }
        
        /* 4. 給表格一個最小寬度，防止 8 個欄位擠在一起 */
        #result {
            min-width: 1000px !important; 
            table-layout: auto !important;
        }

        /* 固定每一欄的最小寬度，防止 Reset 時數據長短造成表格跳動 */
        #result th:nth-child(1), 
        #result td:nth-child(1) { 
            min-width: 70px !important;    /* 增加寬度到 80px，確保三位數也放得下 */
            white-space: nowrap !important; /* 強制禁止換行，這是解決 2-6-1 變垂直的關鍵 */
            text-align: center !important; 
            padding: 10px 5px !important;  /* 稍微縮減內邊距，把空間留給數字 */
        }     /* 序號欄 */
        #result th:nth-child(2) { min-width: 160px; }      /* START DATE */
        #result th:nth-child(3) { min-width: 160px; }      /* END DATE */
        #result th:nth-child(4) { min-width: 120px; }      /* CATEGORY */
        #result th:nth-child(5) { min-width: 200px; }      /* START LOCATION */
        #result th:nth-child(6) { min-width: 200px; }      /* END LOCATION */
        #result th:nth-child(7) { min-width: 100px; }      /* MILES */
        #result th:nth-child(8) { min-width: 150px; }      /* PURPOSE */
        
        /* 確保內容如果太長會自動換行，不會撐開欄位 */
        #result td {
            word-break: break-word;
            vertical-align: middle !important;
        }
    </style>

    <meta charset="utf-8">
    <!-- 引入 ECharts 文件 -->
    <script src="echarts.min.js"></script>

</head>

<body data-target="#navbar-spy" data-spy="scroll">
    <header>
        <nav class="navbar navbar-inverse navbar-fixed-top" id="navbar-spy">
            <!-- Logo-->
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#">MY UBER</a>
                </div>
                <!-- 選單內容 -->
                <div>
                    <ul class="nav navbar-nav">
                        <li><a data-toggle="tab" href="#menu1">TRIP LOGS</a></li>
                    </ul>
                </div>
                <!-- 引入 GOOGLE SEARCH -->
                <script>
                    var domainroot="http://www.google.com"  //Enter domain of site to search.
                    function Gsitesearch(curobj){ curobj.q.value = curobj.qfront.value } 
                </script> 
                <form class="search navbar-form navbar-right" action="https://www.google.com/search" method="get" role="search" target="_blank" onSubmit="Gsitesearch(this)"> 
                    <div class="input-group"> <input name="q" type="hidden" /> 
                        <input class="form-control" name="qfront" type="search" required class="searchField" placeholder="Search Google" maxlength="50"/> 
                        <span class="input-group-btn"> <button type="submit" class="search-button btn btn-primary"> <span class="glyphicon glyphicon-search"></span> </button> </span> 
                    </div> 
                </form>
                <!-- GOOGLE SEARCH END -->
            </div>
        </nav> 
    </header>

    <!-- Dataset Area -->
    <div class="tab-content">
        <div id="menu1" class="tab-pane fade in active">
            <div style="background: black; overflow: hidden;">
                <img src="uber_pic.png" class="banner-img" alt="Uber Trip Banner">
            </div>
            <div style="width: 80%; margin: 0 auto;">
                <div class="row" style="margin-top: 30px; padding: 0 15px; display: flex; flex-wrap: wrap; align-items: center; justify-content: center;">
                
                    <div class="col-md-2 col-xs-12" style="margin-bottom: 15px;">
                        <button type="button" class="btn btn-default btn-block" onclick="default_()" style="height: 34px;">Reset</button>
                    </div>
    
                    <div class="col-md-4 col-xs-12" style="margin-bottom: 15px;">
                        <div class="dropdown">
                            <button class="btn btn-primary dropdown-toggle btn-block" type="button" data-toggle="dropdown" style="height: 34px;">
                                <span id="selected_purpose_text">Select Purpose</span>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" id="purpose_list" style="width: 100%; max-height: 300px; overflow-y: auto;">
                                <li><a href="javascript:void(0)" onclick="selectPurpose('')">-- All Purposes --</a></li>
                                <li role="separator" class="divider"></li>
                            </ul>
                            <input type="hidden" id="search_item_2" value="">
                        </div>
                    </div>
    
                    <div class="col-md-4 col-xs-12" style="margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 5px; height: 34px;">
                            <input id="small_" type="number" class="form-control" style="width: 80px; height: 34px;" value="0">
                            <span style="font-size: 18px; line-height: 1;">~</span>
                            <input id="big_" type="number" class="form-control" style="width: 80px; height: 34px;" value="500">
                            <button class="btn btn-info" type="button" onclick="range_()" style="height: 34px;">Miles Filter</button>
                        </div>
                    </div>
                </div>
            </div>

            <table id="result" class ="table table-bordered" style="margin-top: 3%;width:80%;font-size:16px;margin-left:auto;margin-right:auto;">
            <thead>
                <tr>
                    <th> </th>
                    <!-- <th>sequence <i class="fas fa-caret-square-down" onclick=""></i><i class="fas fa-caret-square-up" onclick=""></i></th> -->
                    <th>START DATE <i class="fas fa-caret-square-down" onclick="startdate_sort_down()"></i><i class="fas fa-caret-square-up" onclick="startdate_sort_up()"></i></th>
                    <th>END DATE <i class="fas fa-caret-square-down" onclick="enddate_sort_down()"></i><i class="fas fa-caret-square-up" onclick="enddate_sort_up()"></i></th>
                    <th>CATEGORY <i class="fas fa-caret-square-down" onclick="catalog_sort_down()"></i><i class="fas fa-caret-square-up" onclick="catalog_sort_up()"></i></th>
                    <th>START LOCATION <i class="fas fa-caret-square-down" onclick="start_sort_down()"></i><i class="fas fa-caret-square-up" onclick="start_sort_up()"></i></th>
                    <th>END LOCATION <i class="fas fa-caret-square-down" onclick="destination_sort_down()"></i><i class="fas fa-caret-square-up" onclick="destination_sort_up()"></i></th>
                    <th>MILES <i class="fas fa-caret-square-down" onclick="mile_sort_down()"></i><i class="fas fa-caret-square-up" onclick="mile_sort_up()"></i></th>
                    <th>PURPOSE <i class="fas fa-caret-square-down"onclick="purpose_sort_down()"></i><i class="fas fa-caret-square-up" onclick="purpose_sort_up()"></i></th>   
                </tr>
                <!-- visual -->
                <tr>
                    <!-- SLIDER -->
                    <th>
                        <!-- <button class="btn btn-default" type="submit" onclick="slider_()">%</button>
                        <div id='volume' class='slider' > 
                            <div class='slider-track'>
                                <div class='slider-thumb'>100</div>
                                <div class='slider-level'></div>
                            </div>
                            <input class='slider-input' type='range' value='100' min='0' max='100' />
                        </div> -->
                        <script>
                            "use strict";
                            function Slider(slider){
                            this.slider = slider;
                            var sldinput= this.slider.querySelector('.slider-input');//input
                            var sldthumb= this.slider.querySelector('.slider-thumb');//中间按钮
                            var sldlevel= this.slider.querySelector('.slider-level');//当前值显示的进度
                            this.slider.addEventListener('input', function() {
                                    // console.log('dddddddd');
                                    this.updateSliderLevel();
                                }.bind(this), false);
                            
                            this.updateSliderLevel =function() {
                                var val=parseInt(sldinput.value);
                                sldthumb.style.left = val + '%';//更新按钮的位置
                                sldthumb.textContent = val;   //更新近钮上显示的值
                                sldlevel.style.width = val + '%';//更新进度条的长度
                            }
                            }
                            var volumeSlider =document.getElementById('volume');
                            new Slider(volumeSlider);

                            function slider_(){
                            var volumn = 0;
                            volumn = document.getElementById("volume").innerText;
                            // volumn = sldthumb;
                            console.log(volumn);
                            var num=0;
                            if(volumn != 0){
                                num = Math.round(1155*(volumn*0.01));
                            }
                            console.log(num);
                            if(num == 0){
                                var srearchItem = "HELLO"
                                console.log(srearchItem)
                                var purpose_ = database.ref('/index').orderByChild('PURPOSE').equalTo(srearchItem);
                                var djson;

                                purpose_.on('value', function(snapshot){
                                    djson_ = JSON.parse(JSON.stringify(snapshot.val()));

                                    djson = jsonToArray(djson_)
                                    console.log(djson)

                                    // djson = djson.sort(up_compare("PURPOSE"));
                                    // console.log(djson);
                                    
                                    var tr = "";
                                    var i = 1;
                                    for(x in djson){
                                        if(djson[x] != null){
                                            tr += "<tr>";
                                            tr += "<td>"+i+"</td>";
                                            tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                                            tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                                            tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                                            tr += "<td>"+djson[x]["START"]+"</td>";
                                            tr += "<td>"+djson[x]["STOP"]+"</td>";
                                            tr += "<td>"+djson[x]["MILES"]+"</td>";
                                            tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                                            tr += "</tr>";
                                            i ++; 
                                        }    
                                    }
                                    document.querySelector("table tbody").innerHTML = tr;
                                });
                            }
                            var prec_ = database.ref('/index').orderByChild('MILES').limitToFirst(num);
                            var djson;
                            var djson_;

                            prec_.on('value', function(snapshot){
                                djson_ = JSON.parse(JSON.stringify(snapshot.val()));

                                djson = jsonToArray(djson_)
                                console.log(djson)

                                // djson = djson.sort(up_compare("PURPOSE"));
                                // console.log(djson);
                                
                                var tr = "";
                                var i = 1;
                                for(x in djson){
                                    if(djson[x] != null){
                                        tr += "<tr>";
                                        tr += "<td>"+i+"</td>";
                                        tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                                        tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                                        tr += "<td>"+djson[x]["MILES"]+"</td>";
                                        tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                                        tr += "<td>"+djson[x]["START"]+"</td>";
                                        tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                                        tr += "<td>"+djson[x]["STOP"]+"</td>";
                                        tr += "</tr>";
                                        i ++; 
                                    }    
                                }
                                document.querySelector("table tbody").innerHTML = tr;
                            });


                            }

                        </script>
                    </th>
                    <!-- 1 start date -->
                    <th>
                            <div id="main" style="width: 120px;height:80px;"></div>
                            <script type="text/javascript">
                                var myChart5 = echarts.init(document.getElementById('main'));
                                var option5 = {
                                    title: {},
                                    tooltip: {},
                                    grid:{
                                    x:0.1,
                                    y:0.1,
                                    x2:0.1,
                                    y2:0.1
                                    // borderWidth:1
                                    },
                                    legend: {
                                    },
                                    xAxis: {
                                        data: ["Jaunary","February","March","April","May","June","July",
                                                "August","September","October","November","December"]
                                    },
                                    yAxis: {    
                                        show: false 
                                    },
                                    series: [{
                                        type: 'bar',
                                        data: [61,115,113,54,49,108,112,133,36,106,122,146],
                                        color:['#37A2DA']
                                    }]
                                };
                                myChart5.setOption(option5);
                            </script>

                    </th>
                     <!--2 //End_date -->
                    <th>
                            <div id="main1" style="width: 120px;height:60px;"></div>
                            <script type="text/javascript">
                                var myChart1 = echarts.init(document.getElementById('main1'));
                                var option1 = {
                                    title: {},
                                    tooltip: {},
                                    legend: {
                                    },
                                    xAxis: {
                                        data: ["Jaunary","February","March","April","May","June","July",
                                                "August","September","October","November","December"]
                                    },
                                    yAxis: {    
                                        show: false 
                                    },
                                    series: [{
                                        type: 'bar',
                                        data: [61,115,113,54,49,108,112,133,36,106,122,146],
                                        // color:['Lightblue']
                                        color: ['#37A2DA', '#32C5E9', '#67E0E3', '#9FE6B8', '#FFDB5C','#ff9f7f', '#fb7293', '#E062AE', '#E690D1', '#e7bcf3', '#9d96f5', '#8378EA']
                                    }]
                                };
                                myChart1.setOption(option1);
                            </script>
                        </th>
                    <!--3 catalogy -->
                    <th>
                        <div id="main2" style="width: 80px;height:80px;"></div>
                        <script type="text/javascript">
                            var myChart = echarts.init(document.getElementById('main2'));
                            var option = {
                                title: {},
                                tooltip: {},
                                legend: {
                                    show: false 
                                },
                                xAxis: {
                                    show: false 
                                    // data: ["Business","Personal"]
                                },
                                yAxis: {    
                                        show: false 
                                    },
                                series: [{
                                    type: 'pie',
                                    data: [{value:1078, name:'Business'},
                                            {value:77, name:'Personal'}]
                                    // color:['Lightblue']
                                }]
                            };
                            myChart.setOption(option);
                        </script>
                    </th>
                    <!-- 4 start -->
                    <th>
                            <div id="main3" style="width: 160px;height:80px;"></div>
                            <script type="text/javascript">
                                var myChart4 = echarts.init(document.getElementById('main3'));
                                var option4 = {
                                    title: {},
                                    tooltip: {},
                                    grid:{
                                    x:0.1,
                                    y:0.1,
                                    x2:0.1,
                                    y2:0.1
                                    // borderWidth:1
                                    },
                                    legend: {
                                    },
                                    xAxis: {
                                    data: ["Cary","Unknown Location","Morrisville","Whitebridge","Islamabad",
                                            "Durham","Lahore","Raleigh","Kar?chi","Apex,Westpark Place",
                                            "Berkeley","Midtown","R?walpindi,Kissimmee,Kenner",
                                            "Emeryville,New Orleans","Downtown","Edgehill Farms,Colombo,Orlando,San Francisco,Banner Elk,Central",
                                            "Hazelwood,The Drag,Oakland","Preston,Covington",
                                            "Fort Pierce,Houston,Noorpur Shahan,South Congress,Sharpstown,Parkway,West Berkeley,Bryson City,Rawalpindi",
                                            "New York,Tanglewood,Waverly Place,Wayne Ridge,Savon Height,CBD,Metairie,Karachi,Agnew,Southside",
                                            "'Fayetteville Street': 3, 'Meredith Townes': 3, 'Northwoods': 3, 'Port Bolivar': 3, 'Menlo Park': 3, 'Huntington Woods': 3, 'Kalorama Triangle': 3",
                                            " 'West Palm Beach': 2, 'Jamaica': 2, 'Hudson Square': 2, 'Farmington Woods': 2, 'Chapel Hill': 2, 'East Elmhurst': 2, 'Katunayaka': 2, 'Heritage Pines': 2, 'Weston': 2, 'West University': 2, 'Galveston': 2, 'Jacksonville': 2, 'Couples Glen': 2, 'Lake Reams': 2, 'Holly Springs': 2, 'Chessington': 2, 'Capitol One': 2, 'Palo Alto': 2, 'Newark': 2, 'Old City': 2, 'Kilarney Woods': 2, 'Storyville': 2, 'Pontchartrain Shores': 2, 'Mandeville': 2, 'Newland': 2, 'Boone': 2, 'Lexington Park at Amberly': 2, 'K Street': 2, 'SOMISSPO': 2, 'San Jose': 2, 'Asheville': 2, 'Topton': 2, 'Renaissance': 2, 'South': 2",
                                            "'Elmhurst': 1, 'East Harlem': 1, 'Flatiron District': 1, 'Midtown East': 1, 'Lower Manhattan': 1, 'Hell's Kitchen': 1, 'Gulfton': 1, 'Eagan Park': 1, 'Lake Wellingborough': 1, 'Fairmont': 1, 'Eastgate': 1, 'Jackson Heights': 1, 'Long Island City': 1, 'Nugegoda': 1, 'East Austin': 1, 'Congress Ave District': 1, 'Red River District': 1, 'Georgian Acres': 1, 'North Austin': 1, 'Coxville': 1, 'Convention Center District': 1, 'Austin': 1, 'Katy': 1, 'Sugar Land': 1, 'Washington Avenue': 1, 'Briar Meadow': 1, 'Latta': 1, 'Sand Lake Commons': 1, 'Sky Lake': 1, 'Daytona Beach': 1, 'Ridgeland': 1, 'Florence': 1, 'Meredith': 1, 'Burtrose': 1, 'Mcvan': 1, 'University District': 1, 'Seattle': 1, 'Redmond': 1, 'Bellevue': 1, 'Sunnyvale': 1, 'Townes at Everett Crossing': 1, 'Seaport': 1, 'Medical Centre': 1, 'Rose Hill': 1, 'Soho': 1, 'Tribeca': 1, 'Financial District': 1, 'Lower Garden District': 1, 'Lakeview': 1, 'Chalmette': 1, 'Arabi': 1, 'Marigny': 1, 'Jamestown Court': 1, 'Summerwinds': 1, 'Parkwood': 1, 'Pontchartrain Beach': 1, 'St Thomas': 1, 'Elk Park': 1, 'Stonewater': 1, 'Arlington Park at Amberly': 1, 'Arlington': 1, 'West End': 1, 'Connecticut Avenue': 1, 'Columbia Heights': 1, 'Washington': 1, 'Wake Forest': 1, 'North Berkeley Hills': 1, 'Eagle Rock': 1, 'Winston Salem': 1, 'Hayesville': 1, 'Almond': 1, 'Mebane': 1, 'Cory': 1, 'Santa Clara': 1, 'NOMA': 1, 'Sunnyside': 1, 'Ingleside': 1, 'Tenderloin': 1, 'College Avenue': 1, 'South Berkeley': 1, 'Mountain View': 1, 'El Cerrito': 1, 'Krendle Woods': 1, 'Wake Co.': 1, 'Fuquay-Varina': 1, 'Katunayake': 1, 'Gampaha': 1"
                                            ]
                                    },
                                    yAxis: {    
                                        show: false 
                                    },
                                    series: [{
                                        type: 'bar',
                                        data: [201,148,85,68,57,
                                                37,36,28,27,17,
                                                16,14,11,
                                                10,9,8,
                                                7,6, 
                                                5,
                                                4,
                                                3,
                                                2,
                                                1],
                                         color:['#37A2DA']
                                    }]
                                };
                                myChart4.setOption(option4);
                            </script>
                    </th>
                    <!--5 end LOCATION -->
                    <th>
                        <div id="main4" style="width: 160px;height:80px;"></div>
                        <script type="text/javascript">
                            var myChart6 = echarts.init(document.getElementById('main4'));
                            var option6 = {
                                title: {},
                                grid:{
                                    x:0.1,
                                    y:0.1,
                                    x2:0.1,
                                    y2:0.1
                                    // borderWidth:1
                                    },
                                tooltip: {},
                                legend: {
                                },
                                xAxis: {
                                    show: false,
                                data: ["Cary","Unknown Location","Morrisville","Whitebridge","Islamabad",
                                        "Durham,Lahore","Raleigh","Kar?chi","Apex",
                                        "Westpark Place,Berkeley","R?walpindi,","Kissimmee","Midtown",
                                        "'Edgehill Farms': 10, 'New Orleans': 10, 'Kenner': 10"," 'Emeryville': 9, 'Central': 9, ",
                                        " 'Colombo': 8, 'San Francisco': 8, 'Oakland': 8, 'Banner Elk': 8",
                                        "'Downtown': 7, 'The Drag': 7, 'Orlando': 7",
                                        " 'Houston': 6, 'Preston': 6, 'Covington': 6",
                                        "'Hazelwood': 5, 'Noorpur Shahan': 5, 'Waverly Place': 5, 'Weston': 5, 'Sharpstown': 5, 'Parkway': 5, 'Metairie': 5, 'Southside': 5, 'Bryson City': 5, 'Rawalpindi': 5",
                                        "'Fort Pierce': 4, 'New York': 4, 'Tanglewood': 4, 'Wayne Ridge': 4, 'Kalorama Triangle': 4, 'Agnew': 4",
                                        "'South Congress': 3, 'Congress Ave District': 3, 'Port Bolivar': 3, 'Chessington': 3, 'Menlo Park': 3, 'Savon Height': 3, 'Lexington Park at Amberly': 3, 'West Berkeley': 3",
                                        "'West Palm Beach': 2, 'Hudson Square': 2, 'Jamestown Court': 2, 'Meredith Townes': 2, 'Leesville Hollow': 2, 'Macgregor Downs': 2, 'Northwoods': 2, 'Jamaica': 2, 'Katunayaka': 2, 'Heritage Pines': 2, 'West University': 2, 'Convention Center District': 2, 'North Austin': 2, 'Galveston': 2, 'Jacksonville': 2, 'Lake Reams': 2, 'Holly Springs': 2, 'Burtrose': 2, 'Capitol One': 2, 'Palo Alto': 2, 'Newark': 2, 'Kildaire Farms': 2, 'Storyville': 2, 'Pontchartrain Shores': 2, 'Mandeville': 2, 'CBD': 2, 'Newland': 2, 'Boone': 2, 'Karachi': 2, 'Asheville': 2, 'Topton': 2, 'Renaissance': 2, 'South': 2",
                                        "'Palm Beach': 1, 'Queens': 1, 'East Harlem': 1, 'NoMad': 1, 'Midtown East': 1, 'Lower Manhattan': 1, 'Hell's Kitchen': 1, \
                                            'Queens County': 1, 'Gulfton': 1, 'Lake Wellingborough': 1, 'Umstead': 1, 'Chapel Hill': 1, 'Williamsburg Manor': 1, \
                                            'Walnut Terrace': 1, 'Jackson Heights': 1, 'East Elmhurst': 1, 'Midtown West': 1, 'Long Island City': 1, 'Nugegoda': 1, \
                                            'Depot Historic District': 1, 'Arts District': 1, 'Red River District': 1, 'Coxville': 1, 'Katy': 1, 'Alief': 1, \
                                            'Sugar Land': 1, 'Washington Avenue': 1, 'Briar Meadow': 1, 'Greater Greenspoint': 1, 'Latta': 1, 'Isles of Buena Vista': 1,\
                                             'Vista East': 1, 'Sky Lake': 1, 'Sand Lake Commons': 1, 'Daytona Beach': 1, 'Ridgeland': 1, 'Florence': 1, 'Cedar Hill': 1, \
                                             'Harden Place': 1, 'University District': 1, 'Redmond': 1, 'Bellevue': 1, 'Seattle': 1, 'Mcvan': 1, 'Sunnyvale': 1,\
                                              'Parkway Museums': 1, 'Hog Island': 1, 'Kilarney Woods': 1, 'Gramercy-Flatiron': 1, 'Tudor City': 1, 'Soho': 1, \
                                              'Tribeca': 1, 'Financial District': 1, 'Kips Bay': 1, 'Bay Farm Island': 1, 'Lower Garden District': 1, \
                                              'Lakeview': 1, 'Faubourg Marigny': 1, 'Bywater': 1, 'Chalmette': 1, 'Arabi': 1, 'Marigny': 1, 'Summerwinds': 1, \
                                              'Parkwood': 1, 'Pontchartrain Beach': 1, 'St Thomas': 1, 'Elk Park': 1, 'Stonewater': 1, 'Arlington Park at Amberly': 1,\
                                               'Washington': 1, 'K Street': 1, 'Northwest Rectangle': 1, 'Columbia Heights': 1, 'Arlington': 1, 'Farmington Woods': 1,\
                                                'Wake Forest': 1, 'French Quarter': 1, 'North Berkeley Hills': 1, 'San Jose': 1, 'Eagle Rock': 1, 'Huntington Woods': 1,\
                                                 'Winston Salem': 1, 'Hayesville': 1, 'Almond': 1, 'Mebane': 1, 'Santa Clara': 1, 'Cory': 1, 'Sunnyside': 1, 'Ingleside': 1,\
                                                  'Potrero Flats': 1, 'SOMISSPO': 1, 'Tenderloin': 1, 'College Avenue': 1, 'Southwest Berkeley': 1, 'South Berkeley': 1,\
                                                   'Mountain View': 1, 'El Cerrito': 1, 'Wake Co.': 1, 'Fuquay-Varina': 1, 'Gampaha': 1, 'Ilukwatta': 1"
                                        ]
                                },
                                yAxis: {    
                                    show: false 
                                },
                                series: [{
                                    type: 'bar',
                                    data: [203,149,84,65,58,
                                            36,29,26,17,
                                            16,13,12,11,
                                            10,9,
                                            8,
                                            7,
                                            6, 
                                            5,
                                            4,
                                            3,
                                            2,
                                            1],
                                    color:['#37A2DA']
                                }]
                            };
                            myChart6.setOption(option6);
                        </script>             
                    </th>
                    <!--6 miles -->
                    <th>
                        <div id="main5" style="width: 150px;height:80px;"></div>
                        <script type="text/javascript">
                            var myChart2 = echarts.init(document.getElementById('main5'));
                            var option2 = {
                                title: {},
                                tooltip: {},
                                // grid:{
                                //     x:1,
                                //     y:1,
                                //     x2:1,
                                //     y2:1
                                //     // borderWidth:1
                                //     },
                                legend: {
                                    show: false 
                                },
                                xAxis: {
                                    show: false
                                    // data: ["[0-5)","[5-10)","[10-20)","[20-50)","[50- )"]
                                },
                                yAxis: {    
                                    show: false 
                                },
                                series: [{
                                    type: 'pie',
                                    data: [{value:496, name:'[0,5)'},
                                            {value:341,name:'[5.10)'},
                                            {value:234,name:'[10,20)'},
                                            {value:57, name:'[20,50)'},
                                            {value:27, name:'[50, )'}]
                                    // color:['Lightblue']
                                }]
                            };
                            myChart2.setOption(option2);
                        </script>
                    </th>
                    <!--7 purpose -->
                    <th>
                            <div id="main6" style="width: 160px;height:80px;"></div>
                            <script type="text/javascript">
                                var myChart3 = echarts.init(document.getElementById('main6'));
                                var option3 = {
                                    title: {},
                                    tooltip: {},
                                    grid:{
                                    x:0.1,
                                    y:0.1,
                                    x2:0.1,
                                    y2:0.1
                                    // borderWidth:1
                                    },
                                    legend: {
                                    },
                                    xAxis: {
                                        data: ["Other","Errand/Supplies","Meeting","Customer Visit",
                                                "Temporary Site","Between Offices","Charity ($)","Commute",
                                                "Moving","Airport/Travel"]
                                    },
                                    yAxis: {    
                                        show: false 
                                    },
                                    series: [{
                                        type: 'bar',
                                        data: [160,502,128,187,101,50,18,1,1,4,3],
                                         color:['#37A2DA']
                                    }]
                                };
                                myChart3.setOption(option3);
                            </script>
                    </th>
                </tr>
            </thead>
            <tbody>
            </tbody>
            </table>

        </div>
    </div>
    <script>
        var config = {
            apiKey: "AIzaSyA1VQOAtkGbdNbpQKVD9hI0VYtBmRq6j8I",
            authDomain: "project551.firebaseapp.com",
            databaseURL: "https://project551.firebaseio.com",
            projectId: "project551",
            storageBucket: "project551.appspot.com",
            messagingSenderId: "227141625715",
            appId: "1:227141625715:web:a12885fbb115acf6fd8706",
            measurementId: "G-S6YXCTHX32"
        };
        firebase.initializeApp(config);
        // Get a reference to the database service
        var database = firebase.database();
        var myuber = database.ref('/index/');
        var djson;

        myuber.on('value', function(snapshot){
            djson = JSON.parse(JSON.stringify(snapshot.val()));
            console.log(djson);
            var tr = "";
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+x+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                }    
            }
            document.querySelector("table tbody").innerHTML = tr;
        });
    </script>
    <script>
    //done
    function default_(){
        var database = firebase.database();
        var myuber = database.ref('/index/');
        var djson;

        myuber.on('value', function(snapshot){
            djson = JSON.parse(JSON.stringify(snapshot.val()));
            console.log(djson);
            var tr = "";
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+x+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                }    
            }

            document.querySelector("table tbody").innerHTML = tr;
        });
    }

    // #升序
    function up_compare(property){
        return function(obj1, obj2) {
            var value1 = obj1[property];
            var value2 = obj2[property];
            return value1 - value2;
        }
        // var sortObj = infoObj.sort(compare())
    }
    // #降序
    function down_compare(property){
        return function(obj1, obj2) {
            var value1 = obj1[property];
            var value2 = obj2[property];
            return value2 - value1;
        }
    }

    // 字典跟array的exchange
    function jsonToArray (obj) {
        // const obj = JSON.parse(str);
        const result = [];
        for (let key in obj) {
            // result.push(key);
            result.push(obj[key]);
        }
        return result;
    }

    //done
    function mile_sort_up(){
        var database = firebase.database();
        var mile_ = database.ref('/index').orderByChild('MILES').limitToFirst(500);
        var djson;

        mile_.on('value', function(snapshot){

            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)
            djson = djson.sort(up_compare("MILES"));
            console.log(djson);

            var tr = "";
            var i = 1;
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+i+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                    i++;
                }    
            }
            // tr.sort()
            document.querySelector("table tbody").innerHTML = tr;
        });
    }
    //done
    function mile_sort_down(){
        var mile_ = database.ref('/index/').orderByChild('MILES').limitToLast(500);
        var djson;
        // console.log(mile_sort);
        mile_.on('value', function(snapshot){

            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)
            djson = djson.sort(down_compare("MILES"));
            console.log(djson);

            var tr = "";
            var i = 1;
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+i+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                    i++
                }    
            }
            // tr.sort()
            document.querySelector("table tbody").innerHTML = tr;
        });
    }

    //done
    function up_date(property){
        return function(obj1, obj2) {
            var value1 = obj1[property];
            var value2 = obj2[property];
            return (value1 - value2)?-1:1;
        }
    }
    //done
    function down_date(property){
        return function(obj1, obj2) {
            var value1 = obj1[property];
            var value2 = obj2[property];
            return (value2 - value1)?1:-1;
        }
    }
    //done
    function enddate_sort_up(){
        var mile_ = database.ref('/index').orderByChild('END_DATE').limitToFirst(500);
        var djson;
        // console.log(mile_sort);
        mile_.on('value', function(snapshot){

            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)
            djson = djson.sort(up_date("END_DATE"));
            console.log(djson);

            var tr = "";
            var i = 1;
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+i+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                    i++
                }    
            }
            // tr.sort()
            document.querySelector("table tbody").innerHTML = tr;
        });
    }
    //done
    function enddate_sort_down(){
        var database = firebase.database();
        var myuber = database.ref('/index/').orderByChild('END_DATE').limitToFirst(500);
        var djson;

        myuber.on('value', function(snapshot){
            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            console.log(djson_);
            djson = jsonToArray(djson_)
            console.log(djson)
            djson.sort(down_date("END_DATE"));
            // console.log(djson);


            var tr = "";
            var i = 1;
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+i+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                    i++
                }    
            }

            document.querySelector("table tbody").innerHTML = tr;
        });
    }
    //done
    function startdate_sort_up(){
        var mile_ = database.ref('/index').orderByChild('START_DATE').limitToFirst(500);
        var djson;
        // console.log(mile_sort);
        mile_.on('value', function(snapshot){

            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)
            djson = djson.sort(up_date("START_DATE"));
            console.log(djson);

            var tr = "";
            var i = 1;
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+i+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                    i++
                }    
            }
            // tr.sort()
            document.querySelector("table tbody").innerHTML = tr;
        });
    }
    //done
    function startdate_sort_down(){
        var database = firebase.database();
        var myuber = database.ref('/index/').orderByChild('START_DATE').limitToFirst(500);
        var djson;

        myuber.on('value', function(snapshot){
            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            console.log(djson_);
            djson = jsonToArray(djson_)
            console.log(djson)
            djson.sort(down_date("START_DATE"));
            // console.log(djson);


            var tr = "";
            var i = 1;
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+i+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                    i++
                }    
            }

            document.querySelector("table tbody").innerHTML = tr;
        });
    }

    //done
    function catalog_sort_up(){
        var catalog_ = database.ref('/index').orderByChild('CATEGORY').equalTo('Business');
        var djson;

        catalog_.on('value', function(snapshot){
            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)
            // djson = djson.sort(up_compare("CATEGORY"));
            // console.log(djson);

            var tr = "";
            var i = 1;
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+i+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                    i ++;
                }    
            }
            document.querySelector("table tbody").innerHTML = tr;
        });
    }
    //done
    function catalog_sort_down(){
        var catalog_ = database.ref('/index').orderByChild('CATEGORY').equalTo('Personal');
        var djson;

        catalog_.on('value', function(snapshot){
            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)
            djson = djson.sort(down_compare("CATEGORY"));
            console.log(djson);

            var tr = "";
            var i = 1;
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+i+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                    i ++;
                }    
            }
            document.querySelector("table tbody").innerHTML = tr;
        });
    }

    function up_string(property){
        return function(obj1, obj2) {
            var value1 = obj1[property];
            var value2 = obj2[property];
            return (value1 > value2)?1:-1;
        }
        // var sortObj = infoObj.sort(compare())
    }
    function down_string(property){
        return function(obj1, obj2) {
            var value1 = obj1[property];
            var value2 = obj2[property];
            return (value2 > value1)?1:-1;
        }
        // var sortObj = infoObj.sort(compare())
    }
    //done
    function purpose_sort_up(){
        var purpose_ = database.ref('/index').orderByChild('PURPOSE').limitToFirst(500);
        var djson;

        purpose_.on('value', function(snapshot){
            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)
            djson = djson.sort(up_string("PURPOSE"));
            console.log(djson);
            var tr = "";
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+x+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                }    
            }
            document.querySelector("table tbody").innerHTML = tr;
        });
    } 
    //done
    function purpose_sort_down(){
        var purpose_ = database.ref('/index').orderByChild('PURPOSE').limitToLast(500);
        var djson;

        purpose_.on('value', function(snapshot){
            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)

            djson = djson.sort(down_string("PURPOSE"));
            console.log(djson);
            var tr = "";
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+x+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                }    
            }
            document.querySelector("table tbody").innerHTML = tr;
        });
    } 
    //done
    function start_sort_up(){
        var purpose_ = database.ref('/index/').orderByChild('START LOCATION').limitToFirst(500);
        var djson;

        purpose_.on('value', function(snapshot){
            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)
            djson = djson.sort(up_string("START LOCATION"));
            console.log(djson);
            var tr = "";
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+x+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                }    
            }
            document.querySelector("table tbody").innerHTML = tr;
        });
    } 
    //done
    function start_sort_down(){
        var purpose_ = database.ref('/index/').orderByChild('START LOCATION').limitToLast(500);
        var djson;

        purpose_.on('value', function(snapshot){
            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)
            djson = djson.sort(down_string("START LOCATION"));
            console.log(djson);
            var tr = "";
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+x+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                }    
            }
            document.querySelector("table tbody").innerHTML = tr;
        });
    }

    //done
    function destination_sort_up(){
        var purpose_ = database.ref('/index/').orderByChild('STOP').limitToFirst(500);
        var djson;

        purpose_.on('value', function(snapshot){
            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)
            djson = djson.sort(up_string("STOP"));
            console.log(djson);
            var tr = "";
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+x+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                }    
            }
            document.querySelector("table tbody").innerHTML = tr;
        });
    } 
    //done
    function destination_sort_down(){
        var purpose_ = database.ref('/index/').orderByChild('STOP').limitToLast(500);
        var djson;

        purpose_.on('value', function(snapshot){
            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)
            djson = djson.sort(down_string("STOP"));
            console.log(djson);
            var tr = "";
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+x+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                }    
            }
            document.querySelector("table tbody").innerHTML = tr;
        });
    } 

    //to be continue...
    function search_catalogy(){
        var srearchItem = document.getElementById("search_item_1").value;
        console.log(srearchItem)
        var purpose_ = database.ref('/index').orderByChild('CATEGORY').equalTo(srearchItem);
        var djson;

        purpose_.on('value', function(snapshot){
            djson_ = JSON.parse(JSON.stringify(snapshot.val()));
            djson = jsonToArray(djson_)
            console.log(djson)

            var tr = "";
            var i = 1;
            for(x in djson){
                if(djson[x] != null){
                    tr += "<tr>";
                    tr += "<td>"+i+"</td>";
                    tr += "<td>"+djson[x]["START_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["END_DATE"]+"</td>";
                    tr += "<td>"+djson[x]["CATEGORY"]+"</td>";
                    tr += "<td>"+djson[x]["START"]+"</td>";
                    tr += "<td>"+djson[x]["STOP"]+"</td>";
                    tr += "<td>"+djson[x]["MILES"]+"</td>";
                    tr += "<td>"+djson[x]["PURPOSE"]+"</td>";
                    tr += "</tr>";
                    i ++; 
                }    
            }
            document.querySelector("table tbody").innerHTML = tr;
        });
    }
    //done
    function search_purpose() {
        // 1. 獲取當前選中的 Purpose
        var searchItem = document.getElementById("search_item_2").value;
        // 2. 獲取當前 Miles 的範圍
        var small_ = parseFloat(document.getElementById("small_").value) || 0;
        var big_ = parseFloat(document.getElementById("big_").value) || 99999;
    
        // 如果沒選 Purpose，就視同執行 Miles Filter
        if (searchItem === "") {
            range_(); 
            return;
        }

        var purpose_ = database.ref('/index').orderByChild('PURPOSE').equalTo(searchItem);
    
        purpose_.on('value', function(snapshot) {
            var djson = snapshot.val();
            var tr = "";
            var i = 1;
            
            for (var x in djson) {
                if (djson[x] != null) {
                    // --- 關鍵修改：在這裡同時判斷 Miles 範圍 ---
                    var miles = parseFloat(djson[x]["MILES"]);
                    if (miles >= small_ && miles <= big_) {
                        tr += "<tr>";
                        tr += "<td>" + i + "</td>";
                        tr += "<td>" + djson[x]["START_DATE"] + "</td>";
                        tr += "<td>" + djson[x]["END_DATE"] + "</td>";
                        tr += "<td>" + djson[x]["CATEGORY"] + "</td>";
                        tr += "<td>" + djson[x]["START"] + "</td>";
                        tr += "<td>" + djson[x]["STOP"] + "</td>";
                        tr += "<td>" + djson[x]["MILES"] + "</td>";
                        tr += "<td>" + djson[x]["PURPOSE"] + "</td>";
                        tr += "</tr>";
                        i++;
                    }
                }
            }
            document.querySelector("table tbody").innerHTML = tr;
        });
    }

    function range_() {
        var small_ = parseFloat(document.getElementById("small_").value) || 0;
        var big_ = parseFloat(document.getElementById("big_").value) || 99999;
        // 獲取當前選單的值
        var currentPurpose = document.getElementById("search_item_2").value;
    
        var range_val = database.ref('/index');
        range_val.on('value', function(snapshot) {
            var djson = snapshot.val();
            var tr = "";
            var i = 1;
            for (var x in djson) {
                if (djson[x] != null) {
                    var miles = parseFloat(djson[x]["MILES"]);
                    var purpose = djson[x]["PURPOSE"];
    
                    // --- 同時判斷 Miles 和 Purpose ---
                    var matchMiles = (miles >= small_ && miles <= big_);
                    var matchPurpose = (currentPurpose === "" || purpose === currentPurpose);
    
                    if (matchMiles && matchPurpose) {
                        tr += "<tr>";
                        // ... (中間的 td 代碼與上面一致，請保留你原本的拼接方式) ...
                        tr += "<td>" + i + "</td>";
                        tr += "<td>" + djson[x]["START_DATE"] + "</td>";
                        tr += "<td>" + djson[x]["END_DATE"] + "</td>";
                        tr += "<td>" + djson[x]["CATEGORY"] + "</td>";
                        tr += "<td>" + djson[x]["START"] + "</td>";
                        tr += "<td>" + djson[x]["STOP"] + "</td>";
                        tr += "<td>" + djson[x]["MILES"] + "</td>";
                        tr += "<td>" + djson[x]["PURPOSE"] + "</td>";
                        tr += "</tr>";
                        i++;
                    }
                }
            }
            document.querySelector("table tbody").innerHTML = tr;
        });
    }
    </script>

    <script>
    // 1. 當網頁載入完成後，自動把選項塞進下拉選單
    window.addEventListener('load', function() {
        var purposes = [
            "Other", "Meeting", "Meal/Entertain", "Errand/Supplies", 
            "Customer Visit", "Temporary Site", "Between Offices", 
            "Moving", "Airport/Travel", "Charity", "Commute"
        ];

        var listContainer = document.getElementById('purpose_list');
        if (listContainer) {
            purposes.forEach(function(item) {
                var li = document.createElement('li');
                var a = document.createElement('a');
                a.href = "javascript:void(0)";
                a.innerHTML = item;
                // 點擊選項時執行 selectPurpose 函數
                a.onclick = function() { selectPurpose(item); };
                li.appendChild(a);
                listContainer.appendChild(li);
            });
        }
    });

    // 2. 定義點擊選項後的動作
    function selectPurpose(val) {
        // 更新按鈕文字
        document.getElementById('selected_purpose_text').innerHTML = val ? val : "Select Purpose";
        // 把值存入隱藏的 input，讓 Firebase 邏輯能抓到
        document.getElementById('search_item_2').value = val;
        
        // 觸發搜尋
        if (val === "") {
            default_(); 
        } else {
            search_purpose(); 
        }
    }

    // 3. 原有的視窗縮放邏輯
    window.addEventListener('resize', function() {
        if (typeof myChart !== 'undefined') myChart.resize();
        if (typeof myChart1 !== 'undefined') myChart1.resize();
        if (typeof myChart2 !== 'undefined') myChart2.resize();
        if (typeof myChart4 !== 'undefined') myChart4.resize();
        if (typeof myChart5 !== 'undefined') myChart5.resize();
        if (typeof myChart6 !== 'undefined') myChart6.resize();
    });
    </script>


</body>
</html>


